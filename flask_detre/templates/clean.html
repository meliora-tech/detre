{% extends "layout.html" %}


{% block custom_head %}

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" >
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="http://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"> </script>

    <style>
  .form-input{
    
    padding: .375rem .75rem;
    font-size: 1rem;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: .25rem;
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
  }


        #keyboard, #all-keyboard {
            
margin: 0;
padding: 0;
list-style: none;
}

    #keyboard li, #all-keyboard li  {
    float: left;
    margin: 0 5px 5px 0;
    width: 40px;
    height: 40px;
    line-height: 40px;
    text-align: center;
    background: #fff;
    border: 1px solid #f9f9f9;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    }


        .capslock, .tab, .left-shift {
        clear: left;
        }

            #keyboard .tab, #keyboard .delete, #all-keyboard .tab, #all-keyboard .delete  {
            width: 70px;
            }
            #keyboard .capslock, #all-keyboard .capslock {
            width: 80px;
            }
            #keyboard .return, #all-keyboard .return  {
            width: 77px;
            }
            #keyboard .left-shift, #all-keyboard .left-shift  {
            width: 95px;
            }
            #keyboard .right-shift, #all-keyboard .right-shift  {
            width: 109px;
            }
        .lastitem {
        margin-right: 0;
        }
        .uppercase {
        text-transform: uppercase;
        }
        #keyboard .space, #all-keyboard .space  {
        clear: left;
        width: 681px;
        }
        .on {
        display: none;
        }
        #keyboard li:hover, #all-keyboard li:hover  {
        position: relative;
        top: 1px;
        left: 1px;
        border-color: #e5e5e5;
        cursor: pointer;
        }

        .btn-default{
            background-color: #fff;
        }
        div.toggle .btn{
            width: 100px;
        }
    </style>
</head>

{% endblock %}

{% block content %}
<br>
<h1 class="text-center">Results </h1>
<br>

<div class="text-center">
    <a id="download-file" class="btn btn-lg" style="font-weight: 900; background-color: #B8EBD0; text-decoration: none; color: #000;" href='{{url_for('route_bp.excel')}}' >Download xlsx</a>
</div>
<br>

<div class="container text-center">
    <ul class="nav nav-pills nav-fill">
    {% for res in all_data %}
         {% for col in res.keys() %}
            {% if loop.index == 1 %}
                <li class="nav-item">
                    <a  class="nav-link ml-4 active show" id="{{col}}-column-tab" data-toggle="tab" href="#{{col}}-column" role="tab" aria-controls="{{col}}-column" aria-selected="false" style="background-color: #8D5A97;color: #f9f9f9;width:250px;margin-top:8px" >{{col}}</a>
                </li>
            {% else %}
                <li class="nav-item">
                    <a  class="nav-link ml-4" id="{{col}}-column-tab" data-toggle="tab" href="#{{col}}-column" role="tab" aria-controls="{{col}}-column" aria-selected="false" style="background-color: #8D5A97;color: #f9f9f9;width:250px;margin-top:8px" >{{col}}</a>
                </li>      
            {% endif %}         
            
         {% endfor %}
    {% endfor%}
      </ul>


         


</div>


<br>
<!-- Create the tab for each column -->
{% for res in all_data %}
    {% for col in res.keys() %}
    <div class="tab-pane fade" id="{{col}}-column" role="tabpanel" aria-labelledby="{{col}}-column-tab"> 
            <ul class="nav nav-tabs" id="myTab-{{col}}" role="tablist">
            
                        <li class="nav-item">
                            <a class="nav-link active show" id="{{col}}-correct-tab" data-toggle="tab" href="#{{col}}-correct" role="tab" aria-controls="{{col}}" aria-selected="false">Correct</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="{{col}}-issues-tab" data-toggle="tab" href="#{{col}}-issues" role="tab" aria-controls="{{col}}" aria-selected="false">Issues</a>
                        </li>
                       <!-- <li class="nav-item">
                            <a class="nav-link" id="{{col}}-guidance-tab" data-toggle="tab" href="#{{col}}-guidance" role="tab" aria-controls="{{col}}" aria-selected="false">Guidance</a>
                        </li> --> 
                        <li class="nav-item">
                            <a class="nav-link" id="{{col}}-profile-tab" data-toggle="tab" href="#{{col}}-profile" role="tab" aria-controls="{{col}}" aria-selected="false">Profile</a>
                        </li>             
            </ul>
        </div>
    {% endfor %}
  {% endfor%}

  <div class="tab-content" id="myTabContent">
    {% set inner_count = []  %}
    {% for res in all_data %}
        {% for  col in res.keys() %}
            

        <!-- Tab for data with issues -->
        <div class="tab-pane fade" id="{{col}}-issues" role="tabpanel" aria-labelledby="{{col}}-issues-tab">
            <br>
            <div class="text-center">
                <!-- <button class="btn btn-lg" style="font-weight: 900;">Group changes</button> -->
                <div class="alert alert-success alert-dismissible fade show" role="alert" auto-close="2000" id="{{col}}-alert-result" hidden>
                    <p id="alert-result-message"></p>
                </div>
                <div id="accept-view-cancel" class="container" hidden>
                    <div class="d-flex">
                        <button class="btn ml-2 mr-2" style="width:180px" onclick="acceptAll('{{col}}')" > Accept all</button>
                        <button class="btn ml-2" style="width: 180px;"  id="{{col}}-matches" onclick="matchesOnly('{{col}}')" >View `matches` only</button>
                        <button class="btn mr-2 ml-2" style="width:180px;" onclick="cancelOnly('{{col}}')">Cancel all</button>
                    </div>
                </div>

                <br>
                <br>
                <!--<input type="checkbox" checked data-toggle="toggle" data-on="Ready" data-off="Not Ready" data-onstyle="success" data-offstyle="danger" id="change-all">-->
                <div class="container d-flex" class="text-center" style="float:none; text-align: center;"> 
                    <input style="width: 400px;" type="text" id="all-{{col}}" class="form-input" onfocus="displayAll('all','{{data_types[col]}}')" onfocusout="removeDisplayAll('all','{{data_types[col]}}',window.event)" autocomplete="off" placeholder="Change all">   
                    <button class="btn ml-2" id="button-all" type="button" onclick="submitChange('all-{{col}}','{{data_types[col]}}','true')">Submit</button>
                </div>

                {% if  data_types[col] == "datetime" %}
                                            
                <div id='all-keys-datetime' style="width: 400px;margin-left: 200px;" hidden>
                <ul id="all-keyboard">
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">text</span><span class="on">*</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">*</span><span class="on">!</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">a</span><span class="on">@</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">A</span><span class="on">#</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">b</span><span class="on">$</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">B</span><span class="on">%</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">d</span><span class="on">^</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">m</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">w</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">y</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">Y</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">H</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">I</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">p</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">M</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">S</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">Excel</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">remove</span><span class="on">&amp;</span></li>
                </ul>
                <br>
                <br>
                <br>
              </div>   
              {% elif  "phone" in data_types[col]  %}

              <div class="" id='all-keys-phone' style="width: 400px;margin-left: 200px;" hidden>
                <ul id="all-keyboard">
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" style="width:75px"><span class="off"  tabindex="-1">text[D]</span><span class="on">text[D]</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">tel</span><span class="on">tel</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">*</span><span class="on">*</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">d</span><span class="on">d</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" style="width:100px"><span class="off"  tabindex="-1">remove</span><span class="on">remove</span></li>
                    {% if data_types[col] == "text-phone" %}
                      <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" style="width:75px"><span class="off"  tabindex="-1">text</span><span class="on">text</span></li>
                    {% endif %}

                </ul>
                <br>
              </div> 

              {% elif data_types[col] == "date" %}
              <div class="" id='all-keys-date' style="width: 400px;margin-left: 200px;" hidden>
                <ul id="all-keyboard">
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">text</span><span class="on">*</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">*</span><span class="on">!</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">a</span><span class="on">@</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">A</span><span class="on">#</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">b</span><span class="on">$</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">B</span><span class="on">%</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">d</span><span class="on">^</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">m</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">w</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">y</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">Y</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">Excel</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off"  tabindex="-1">remove</span><span class="on">&amp;</span></li>
                </ul>
              </div>  
              {% elif data_types[col] == "time" %}
              <div class="" id='all-keys-time' style="width: 400px;margin-left: 200px;" hidden>
                <ul id="all-keyboard">
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">text</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">text[D]</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">*</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">H</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">I</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">p</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">M</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">S</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">Excel</span><span class="on">&amp;</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">remove</span><span class="on">&amp;</span></li>
                </ul>
              </div>   

              {% elif  "email" in data_types[col]  %}
              <div class="" id='all-keys-email' style="width: 400px;margin-left: 200px;" hidden>
                <ul id="all-keyboard">
                   <!--  <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" ><span class="off"  tabindex="-1">@</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">LP</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" style="width:60px"><span class="off" tabindex="-1">domain</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">*</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">.</span></li> -->
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" style="width:75px"><span class="off" tabindex="-1">remove</span></li>
                </ul>
              </div>   

              {% elif data_types[col] == "whole" %}
              <div id='all-keys-whole' style="width: 400px;margin-left: 200px;"  hidden>
                <ul id="all-keyboard">
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">text</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">d</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" style="width:150px"><span class="off" tabindex="-1">remove</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">*</span></li>
                </ul>
              </div>
              
              {% elif data_types[col] == "decimal" %}
              <div class="" id='all-keys-decimal' style="width: 400px;margin-left: 200px;" hidden>
                <ul id="all-keyboard">
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">text</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">d</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)" style="width:150px"><span class="off" tabindex="-1">remove</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">*</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">,</span></li>
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">.</span></li>
                </ul>
              </div>

              {% else %}
              <div class="" id='all-keys' style="width: 400px;margin-left: 200px;" hidden>
                <ul id="all-keyboard">
                    <li class="symbol" onclick="keyboardValue('all-{{col}}',this)"><span class="off" tabindex="-1">text</span><span class="on">*</span></li>
                </ul>
              </div> 

              {% endif %}
            






            </div>
            <br>
            <br>
            <br>
               <div class="container">  
  
                <p style="font-weight: 900;">Incorrect values </p>
                        <table class="table table-responsive " id='incorrect-values'>
                            <thead>
                                <th>  <input type="checkbox" onchange="checkAll()"> </th>
                                <th>Your value</th>
                                <th>Detre Guidance </th>
                                <th>Updated Value</th>
                                <th>Action</th>
                                <th></th>
                                <th></th>
                            </thead>
                            <tbody>

                                {% for values in res[col][1]['incorrect'] %}

                                    {% if loop.index < 1000 %}
                                    <tr id='row-{{values.row}}'>
                                        <td> <input type="checkbox" > </td>
                                         <td> <p> {{values.value | safe }} </p> </td>
                                         <td> <p> {{values.detre | safe  }}  </p> </td>
                                         <td> <p id="update-{{values.row}}"> {{values.new_value | safe }} </p> </td>
                                         <td>  
                                            <input type="text" id="{{col}}-row-{{values.row}}" class="form-control keyboard-input" onfocus="display({{values.row}},'{{data_types[col]}}')" onfocusout="removeDisplay('{{values.row}}',window.event)" autocomplete="off" >   
                                            {% if  data_types[col] == "datetime" %}
                                            
                                            <div class="" id='keys-{{values.row}}' hidden>
                                                <ul id="keyboard">
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">text</span><span class="on">*</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">*</span><span class="on">!</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">a</span><span class="on">@</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">A</span><span class="on">#</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">b</span><span class="on">$</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">B</span><span class="on">%</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">d</span><span class="on">^</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">m</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">w</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">y</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">Y</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">H</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">I</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">p</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">M</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">S</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">Excel</span><span class="on">&amp;</span></li>
                                                    <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">remove</span><span class="on">&amp;</span></li>
                                                </ul>
                                            </div>   
                                          {% elif "phone" in data_types[col] %}

                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:75px"><span class="off"  tabindex="-1">text[D]</span><span class="on">text[D]</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">tel</span><span class="on">tel</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">*</span><span class="on">*</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">d</span><span class="on">d</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:100px"><span class="off"  tabindex="-1">remove</span><span class="on">remove</span></li>
                                                {% if data_types[col] == "text-phone" %}
                                                  <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:75px"><span class="off"  tabindex="-1">text</span><span class="on">text</span></li>
                                                {% endif %}
                                            </ul>
                                          </div> 

                                          {% elif data_types[col] == "date" %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">text</span><span class="on">*</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">*</span><span class="on">!</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">a</span><span class="on">@</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">A</span><span class="on">#</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">b</span><span class="on">$</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">B</span><span class="on">%</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">d</span><span class="on">^</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">m</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">w</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">y</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">Y</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">Excel</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">remove</span><span class="on">&amp;</span></li>
                                            </ul>
                                          </div>  
                                          {% elif data_types[col] == "time" %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">text</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">text[D]</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">*</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">H</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">I</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">p</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">M</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">S</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">Excel</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">remove</span><span class="on">&amp;</span></li>
                                            </ul>
                                          </div>   

                                          {% elif data_types[col] == "text-email" %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                               <!--  <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off"  tabindex="-1">@</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">LP</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:60px"><span class="off" tabindex="-1">domain</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">*</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">.</span></li> -->
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:75px"><span class="off" tabindex="-1">remove</span></li>
                                            </ul>
                                          </div>  
                                          
                                          {% elif "url" in data_types[col] %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:75px"><span class="off" tabindex="-1">domain</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:105px"><span class="off" tabindex="-1">domain[text]</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:75px"><span class="off"  tabindex="-1">protocol</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:75px"><span class="off" tabindex="-1">tld</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">text</span></li> 
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">/</span></li> 
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">.</span></li> 
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">:</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">*</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:75px"><span class="off" tabindex="-1">remove</span></li>
                                            </ul>
                                          </div>  


                                          {% elif data_types[col] == "whole" %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">text</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">d</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:150px"><span class="off" tabindex="-1">remove</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">*</span></li>
                                            </ul>
                                          </div>
                                          
                                          {% elif data_types[col] == "decimal" %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">text</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">d</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" style="width:150px"><span class="off" tabindex="-1">remove</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">*</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">,</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">.</span></li>
                                            </ul>
                                          </div>
                                          {% elif "text" in data_types[col] %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">text</span><span class="on">*</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">*</span><span class="on">!</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">a</span><span class="on">@</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">A</span><span class="on">#</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)" ><span class="off" tabindex="-1">b</span><span class="on">$</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">B</span><span class="on">%</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">d</span><span class="on">^</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">m</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">w</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">y</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">Y</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">H</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">I</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">p</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">M</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">S</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">Excel</span><span class="on">&amp;</span></li>
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off"  tabindex="-1">remove</span><span class="on">&amp;</span></li>
                                            </ul>
                                        </div> 


                                          {% else %}
                                          <div class="" id='keys-{{values.row}}' hidden>
                                            <ul id="keyboard">
                                                <li class="symbol" onclick="keyboardValue('{{col}}-row-{{values.row}}',this)"><span class="off" tabindex="-1">text</span><span class="on">*</span></li>
                                            </ul>
                                          </div> 

                                          {% endif %}

                                          
                                        </td>
                                       
                                        <td> <button class='btn submit' style="font-weight: 900;" onclick="submitChange('{{col}}-row-{{values.row}}','{{data_types[col]}}')"> Submit </button> </td>
                                    </tr>
                                    {% else %}

                                    {% endif %}

                                {% endfor %}
                            </tbody>
                            
                        </table>
                           
             </div>          
            
        </div>

        <!-- Tab for Correct values -->

        <div class="tab-pane fade" id="{{col}}-correct" role="tabpanel" aria-labelledby="{{col}}-correct-tab">
            <div class="container"> 
                <br>
                <br>
                <table class="table table-responsive" id="correct-values"   >
                    <thead>
                        <th>Your value </th>
                        <th>Detre value </th>
                    </thead>

                    <tbody>
                        {% for values in res[col][0]['correct'] %}
                            {% if loop.index < 1000 %}
                            <tr>
                                <td> {{values.value | safe }} </td>
                                <td> {{values.detre | safe }} </td>
                            </tr>
                            {% else %}
                            
                            {% endif %}
                        {% endfor %}   
                    </tbody>
                </table>
            </div>

        </div> 

        <!-- Tab for Guidance -->
        <div class="tab-pane fade" id="{{col}}-guidance" role="tabpanel" aria-labelledby="{{col}}-guidance-tab">
              <div class="container">
                  <br>
                  <p class="text-center" style="font-weight: 900;"> No outliers spotted </p>
              </div>
        </div>

        <!-- Tab for Duplicates -->
        <div class="tab-pane fade" id="{{col}}-profile" role="tabpanel" aria-labelledby="{{col}}-profile-tab">
            <div class="container">
                <div class="text-center mt-4">
                    <h5> Profile based on correct values only </h5>
                </div>

                <br>
                {% set _ = inner_count.append(1) %}
                {% set count = inner_count| length %} 

                 <div style="display: flex; border-radius: .25rem; flex-wrap: wrap;">
                    <div class="col">
                        <h2 style="font-size: .875rem; line-height: 1; font-weight: 500; white-space: nowrap;"> Duplicates</h2>
                        <p style="font-size: 1.75rem; line-height: 1; margin-bottom: 0; white-space: nowrap;"> {{all_profile[count-1][col]['duplicates_total'] }} </p>
                     </div>
                     <div class="col">
                        <h2 style="font-size: .875rem; line-height: 1; font-weight: 500; white-space: nowrap;"> Min</h2>
                        <p style="font-size: 1.75rem; line-height: 1; margin-bottom: 0; white-space: nowrap;"> {{all_profile[count-1][col]['min'] }} </p>
                     </div>
                     <div class="col">
                        <h2 style="font-size: .875rem; line-height: 1; font-weight: 500; white-space: nowrap;"> Max</h2>
                        <p style="font-size: 1.75rem; line-height: 1; margin-bottom: 0; white-space: nowrap;"> {{all_profile[count-1][col]['max'] }} </p>
                     </div>                    
                     <div class="col">
                        <h2 style="font-size: .875rem; line-height: 1; font-weight: 500; white-space: nowrap;"> Unique </h2>
                        <p style="font-size: 1.75rem; line-height: 1; margin-bottom: 0; white-space: nowrap;"> {{all_profile[count-1][col]['n_unique'] }} </p>
                     </div>

                 </div>

                 <br>
                 <br>

                 {% if all_profile[count-1][col]['duplicates_total'] != 0  %}
                    {% if data_types[col] == "whole" or data_types[col] == "decimal" or data_types[col] == "currency" %}

                        {% if all_profile[count-1][col] != [] %} 
                            <table class="table table-responsive" id="profile-table">
                                <thead>
                                    <th> Value</th>
                                    <th> Freq</th>
                                </thead>
                                <tbody>
                                    {% for dict_item in all_profile[count-1][col]['freq']  %}
                                        {% for key, value in dict_item.items() %} 
                                            <tr> 
                                                <td> {{key}} </td>
                                                <td> {{value}}</td>
                                            </tr>
                                        {% endfor %}    
                                    {% endfor %}
                                </tbody>
                            </table>  
                            {% endif %}

                        {% endif %}
                {% endif %}


                {% if data_types[col] == "phone"  or data_types[col] == "date" or data_types[col] == "datetime" or "text" in data_types[col]  %}
                   
                       {% if all_profile[count-1][col] != [] %} 
                        <table class="table table-responsive" id="profile-table-text">
                            <thead>
                                <th> Value</th>
                                <th> Cluster </th>
                            </thead>
                            <tbody>
                                {% for key, value in all_profile[count-1][col]['text_cluster'].items()  %}
                                    
                                        <tr> 
                                            <td> {{key}} </td>
                                            <td> {{value}}</td>
                                        </tr>
                                    
                                {% endfor %}
                            </tbody>
                        </table>  
                        {% endif %}

                {% endif %}

                
                
                    
            </div>
      </div>

     {% endfor %}
  {% endfor%}

  </div>


  <script>
    // Correct values table  
    $(document).ready( function () {
       $('#correct-values').DataTable({
           select : true,
    

       });
     });

     // Incorrect values table
     $(document).ready( function () {
       $('#incorrect-values').DataTable({
           select : true,
           bFilter: false 

       });
     });     


     //  Profile table
     $(document).ready( function () {
       $('#profile-table').DataTable({
           select : true,
           bFilter: false 

       });
     });     

     //  Profile table for text values
     $(document).ready( function () {
       $('#profile-table-text').DataTable({
           select : true,
           bFilter: false 

       });
     });     


   $(document).ready(function() {
    $('.js-example-basic-single').select2();
    });

    function display(key,dataType){
       
       
        document.getElementById('keys-'+key).removeAttribute('hidden');
    }

    function displayAll(key,dataType){
       if(dataType.includes("text")){
        document.getElementById('all-keys-'+dataType.split("-")[1]).removeAttribute('hidden');
       } else{
        document.getElementById('all-keys-'+dataType).removeAttribute('hidden');
       }
       
   }


    function removeDisplay(key,event){
        // keyboard being clicked

         
         
         
         if(event.relatedTarget != null){
  	        if(event.relatedTarget.tagName == 'SPAN'){
  	         return
  	    }
 
    }

  
            document.getElementById('keys-'+key).setAttribute('hidden','');
    }


    function removeDisplayAll(key,data_type,event){

        if(event.relatedTarget != null){
  	        if(event.relatedTarget.tagName == 'SPAN'){
  	         return
  	    }
 
        }

          if(data_type.includes("text")){
            document.getElementById('all-keys-'+data_type.split("-")[1]).setAttribute('hidden','');
          } else{
            document.getElementById('all-keys-'+data_type).setAttribute('hidden','');
          }
            
    }


    function checkAll(){
        console.log(' dd dd');
    }

    function keyboardValue(id,e){

        // keep on focus
       console.log(id);
        document.getElementById(id).value +=  '' + e.querySelectorAll('span')[0].innerHTML;

        document.getElementById(id).focus();


    }

    function submitChange(input_id,datatype,for_all='false'){

        var url  = window.location.protocol +"//" +location.host;
        
        // Change all or not 

        // Manage for multiple changes
        if(for_all=='true'){

            console.log("Multiple changes");
            if(document.getElementById(input_id).value != ''){

                    // Remove for multiple
                    var action_value = document.getElementById(input_id).value;

                    if(action_value == 'remove'){
                        alert("You are about to drop all your observations. ")
                    } else{
                        let input_arr   = input_id.split("-");
                        let column_name = input_arr.slice(1,).join("-");

                        var rows  = [];
                        document.getElementById(column_name+'-issues').querySelector('table').querySelectorAll("tr[id^='row']").forEach(element => {
                             
                             if(element.style.backgroundColor == ''){
                                rows.push(element.getAttribute('id').split("-")[1]);


                             }


                        });

                        var data = "column="+column_name+'&'+
                                    "rows="+rows+'&'+
                                    "action="+action_value+'&'+
                                    "data_type="+ datatype;


                        var xhttp = new XMLHttpRequest();
                        xhttp.onreadystatechange = function(){
                              if(this.readyState == 4 && this.status == 200){
                                const final_result = JSON.parse(this.responseText);
                                var count_ = 0;
                                

                                if(final_result["error"]==0){
                                    final_result["result"].forEach(element => {
                                     
                                    if(element!='None' && element!= null && element!= undefined){
                                        count_+=1;
                                    }    




                                    });

                                    var total_count = final_result["result"].length;


                                    var all_results = final_result["result"];
                                    var all_rows    = final_result["row"];

                                    console.log(all_rows)
                                    // Message how many were changed.
                                    var p_elem  = document.getElementById("alert-result-message");
                                    console.log(p_elem);
                                    p_elem.innerHTML = count_ +" of " + total_count + " were changed";
                                    
                                    // Display alert message for x seconds
                                    alertAutoDisplayAndClose(column_name)
                                    


                                    for(var i=0;i<all_results.length;i++){
                                        var result = all_results[i];

                                        if(result!='None' && result!= null && result!= undefined){
                                            var row  = all_rows[i];
                                            console.log(row);
                                            document.getElementById("update-"+row).innerText = result;
                                
                                            // Check if the button already exists
                                            var tr = document.getElementById("row-"+row);
                                            var allBtns = tr.querySelectorAll('button');

                                            if(allBtns.length == 1) {
                                                var td    = document.createElement('td');
                                                var btn   = document.createElement('button');
                                                var btnText = document.createTextNode('Accept');
                                                btn.setAttribute('class','btn btn-success');
                                                btn.setAttribute('onclick','acceptChange('+ row+',"'+ column_name +'")');
                                                btn.setAttribute('style','font-weight:900');
                                                btn.append(btnText);
                                                td.append(btn);
                                                tr.append(td);
                                            }



                                        }

                                    }

                                } else{
                                    alert('We could not parse the given action.')
                                }
                              }  
                        }

                        xhttp.open("POST", url+"/update/multiple/values", true);
                        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                        xhttp.send(data);
                    }




            } else{
                alert('Enter some guidance before submitting.');
            }



        } else{
                
                // Manage for a single change
                if(document.getElementById(input_id).value != '' ){
                    let input_arr   = input_id.split("-");
                    let column_name = input_arr.slice(0,input_arr.length - 2).join("-");
                    let row         = input_arr[input_arr.length - 1];
                    let action      = document.getElementById(input_id).value;
                    let data_type   = datatype;
                    
                    // Make request
                    var data = 
                        "column="+column_name+'&'+
                        "row="+ row+'&'+
                        "action="+ action+'&'+
                        "data_type="+ data_type;
                    

                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            const final_result = JSON.parse(this.responseText);

                        
                            if(final_result['error']==0){


                                document.getElementById("update-"+final_result['row']).innerText = final_result['result'];
                                
                                // Check if the button already exists


                                var tr = document.getElementById("row-"+final_result['row']);
                                var allBtns = tr.querySelectorAll('button');

                                if(allBtns.length == 1) {
                                    var td    = document.createElement('td');
                                    var btn   = document.createElement('button');
                                    var btnText = document.createTextNode('Accept');
                                    btn.setAttribute('class','btn btn-success');
                                    btn.setAttribute('onclick','acceptChange('+ final_result['row'] + ',"' + column_name +'")');
                                    btn.setAttribute('style','font-weight:900');
                                    btn.append(btnText);
                                    td.append(btn);
                                    tr.append(td);
                                }
                                



                            } else {
                                alert('We could not parse the given action.')
                            }
                        }
                    };
                    xhttp.open("POST", url+"/update/value", true);
                    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                    xhttp.send(data);          


                    
                } else {
                    alert('Enter some guidance before submitting.');
                }

        }
        




        
    }


    // Accept change
    function acceptChange(id,column_name){
        console.log(column_name);
        // Confirm change has been accepted
        var url       = window.location.protocol +"//" +location.host;
        var row       = document.getElementById('row-'+id);
        var tds       = row.querySelectorAll('td');
        
        var data = 
            'row='+ id+'&'+
            'new_value='+tds[3].innerText+'&'+
            'old_value='+tds[1].innerText+'&'+
            'column_name='+column_name
        
        
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function(){
            if(this.readyState == 4 && this.status == 200){
                 var new_value  = tds[3].innerText; 
                if(new_value == 'remove'){
                    document.getElementById('row-'+id).style.backgroundColor = '#e63946';
                } else {
                    document.getElementById('row-'+id).style.backgroundColor = '#b8ebd0';
                }
                 
            }

        }

        xhttp.open("POST", url+"/accept/update", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(data);   
        
    }

    // Download Excel
    function downloadExcel(){
        var url       = window.location.protocol +"//" +location.host;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function(){
            if(this.readyState == 4 && this.status == 200){
                alert('File has downloaded!')
                 
            }

        }

        xhttp.open("GET", url+"/excel/download", true);
        xhttp.send(); 

    }


   function alertAutoDisplayAndClose(column){
        var alert_ = document.getElementById(column+'-alert-result');
        alert_.removeAttribute('hidden'); 

        var accpet_view_cancel_btn = document.getElementById("accept-view-cancel");
        accpet_view_cancel_btn.removeAttribute('hidden')

       /* $(".alert").alert('close')*/

      setTimeout(function() {
        $(".alert").attr('hidden','')
    }, 2000); 

   } 

   function acceptAll(column){
    document.getElementById(column+'-issues').querySelector('table').querySelectorAll("tr[id^='row']").forEach(element => {
                             element.removeAttribute("hidden");   
                             var element_td_count = element.querySelectorAll('td').length;   
                             if(element.style.backgroundColor == '' && element_td_count == 7){
                                //rows.push(element.getAttribute('id').split("-")[1]);
                                element.style.backgroundColor = '#b8ebd0';

                             }


                        }); 

                        document.getElementById("accept-view-cancel").setAttribute("hidden","");         
   }


  function cancelOnly(column){
    document.getElementById(column+'-issues').querySelector('table').querySelectorAll("tr[id^='row']").forEach(element => {

                            element.removeAttribute("hidden");

                             var element_td_count = element.querySelectorAll('td').length;   
                             if(element.style.backgroundColor == '' && element_td_count == 7){
                                element.style.backgroundColor = '';

                                // remove `accept` btn
                                element.removeChild(element.childNodes[element.childNodes.length -1]);

                                // Clear the `detre` value
                                
                                element.childNodes[7].querySelector('p').innerHTML = "" 
                             }


                        }); 

    document.getElementById("accept-view-cancel").setAttribute("hidden","");         
   }     
  
   function matchesOnly(column){
            console.log(document.getElementById(column+"-matches").innerHTML== "View all")
            if(document.getElementById(column+"-matches").innerHTML == "View all" ){
               
                document.getElementById(column+'-issues').querySelector('table').querySelectorAll("tr[id^='row']").forEach(element => {
                        element.removeAttribute("hidden");
                }); 

                document.getElementById(column+"-matches").innerHTML = "View matches only";  



            } else{

                document.getElementById(column+'-issues').querySelector('table').querySelectorAll("tr[id^='row']").forEach(element => {

                        var element_td_count = element.querySelectorAll('td').length;   
                        if(element.style.backgroundColor == '' && element_td_count == 6){
                            element.setAttribute("hidden","");


                            

                        }


                        }); 

                document.getElementById(column+"-matches").innerHTML = "View all"; 
                                        
            }
                     
        } 



 function changeLayout(x){
    var input = document.querySelectorAll("input.keyboard-input");
    var btn = document.querySelectorAll("button.submit");

     if(x.matches){
        input.forEach(element => {
            element.style.cssText = "display:none";
        });

        btn.forEach(element => {
            element.style.cssText = "display:none";
        })

    
     } else{
        input.forEach(element => {
            element.style.cssText = "display:block";
        });

        btn.forEach(element => {
            element.style.cssText = "display:block";
        });
     }
 }       

 var x = window.matchMedia("(max-width:992px)");

 changeLayout(x);
 x.addListener(changeLayout)

  </script>
  {% endblock %}